<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelola Data Aksara Bali - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #cccccc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #999;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .timestamp {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }
        
        .user-info {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #4f46e5;
        }
        
        .nav-links {
            margin-top: 20px;
        }
        
        .nav-links a {
            color: #999;
            text-decoration: none;
            margin: 0 10px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .nav-links a.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .controls-section {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-container {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
        }
        
        .search-box {
            padding: 12px 16px;
            border: 1px solid #333;
            border-radius: 8px;
            width: 100%;
            font-size: 1rem;
            background: #1a1a1a;
            color: #fff;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            border-color: #555;
            background: #222;
        }
        
        .search-box::placeholder {
            color: #666;
        }
        
        .filter-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .category-filter {
            padding: 12px 16px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1a1a1a;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .category-filter:hover {
            border-color: #555;
            background: #222;
        }
        
        .btn {
            padding: 12px 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #1a1a1a;
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background: #333;
        }
        
        .btn-primary {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        
        .btn-primary:hover {
            background: #4338ca;
            border-color: #4338ca;
        }
        
        .btn-success {
            background: #16a34a;
            color: white;
            border-color: #16a34a;
        }
        
        .btn-success:hover {
            background: #15803d;
            border-color: #15803d;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
            border-color: #b91c1c;
        }
        
        .btn-warning {
            background: #eab308;
            color: black;
            border-color: #eab308;
        }
        
        .btn-warning:hover {
            background: #ca8a04;
            border-color: #ca8a04;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        
        .table-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .table-title {
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
        }
        
        .data-table th {
            text-align: left;
            padding: 15px;
            background: #1a1a1a;
            color: #bbb;
            font-weight: 500;
            border-bottom: 1px solid #333;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #222;
            vertical-align: middle;
        }
        
        .data-table tr:hover {
            background: #181818;
        }
        
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .aksara-cell {
            font-size: 1.8rem;
            text-align: center;
            width: 80px;
        }
        
        .action-cell {
            text-align: right;
            width: 180px;
        }
        
        .category-badge {
            background: #1a1a1a;
            color: #fff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid #333;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
        }
        
        .pagination button {
            padding: 8px 14px;
            border: 1px solid #333;
            border-radius: 6px;
            background: #1a1a1a;
            color: #fff;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #333;
        }
        
        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .pagination .active {
            background: #4f46e5;
            color: #fff;
            border-color: #4f46e5;
        }
        
        .stats-section {
            background: #111;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #999;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            overflow: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: #111;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #333;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #fff;
            font-weight: 600;
        }
        
        .close {
            color: #999;
            font-size: 28px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            color: #fff;
        }
        
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .alert-success {
            background: rgba(22, 163, 74, 0.2);
            border: 1px solid #16a34a;
            color: #4ade80;
        }
        
        .alert-error {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid #dc2626;
            color: #f87171;
        }
        
        .alert-warning {
            background: rgba(234, 179, 8, 0.2);
            border: 1px solid #eab308;
            color: #facc15;
        }
        
        .alert-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 20px;
            cursor: pointer;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid #333;
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .loading-subtext {
            font-size: 0.9rem;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .empty-state p {
            font-size: 1rem;
            color: #666;
        }
        
        .hidden {
            display: none !important;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #bbb;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #555;
            outline: none;
            background: #222;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .model-upload-zone {
            border: 2px dashed #333;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 10px;
            background: #1a1a1a;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .model-upload-zone:hover {
            border-color: #4f46e5;
            background: #222;
        }

        .model-upload-zone input {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls-section {
                flex-direction: column;
                padding: 20px;
                gap: 15px;
            }
            
            .search-container {
                width: 100%;
            }
            
            .filter-container {
                width: 100%;
                justify-content: space-between;
            }
            
            .table-container {
                padding: 15px;
            }
            
            .data-table th, 
            .data-table td {
                padding: 10px;
            }
            
            .aksara-cell {
                font-size: 1.5rem;
            }
            
            .action-cell {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
                width: auto;
            }
            
            .btn-sm {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .btn-group {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .data-table {
                font-size: 0.9rem;
            }
            
            .table-title {
                font-size: 1.2rem;
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .pagination button {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Aksara Bali Digital</h1>
            <p class="subtitle">Kelola Data Aksara</p>
            <p class="timestamp">2025-06-21 09:24:42</p>
            <div class="nav-links">
                <a href="/">Beranda</a>
                <a href="/manage" class="active">Kelola Data</a>
            </div>
        </header>
        
        <div id="alertContainer" class="hidden"></div>
        
        <div class="controls-section">
            <div class="search-container">
                <input type="text" class="search-box" id="searchInput" placeholder="Cari aksara berdasarkan nama atau kategori...">
                <button class="btn btn-primary" id="searchBtn">Cari</button>
            </div>
            
            <div class="filter-container">
                <select class="category-filter" id="categoryFilter">
                    <option value="">Semua Kategori</option>
                    <option value="Aksara Wianjana">Aksara Wianjana</option>
                    <option value="Gantungan">Gantungan</option>
                    <option value="Gempelan">Gempelan</option>
                    <option value="Aksara Swalalita">Aksara Swalalita</option>
                    <option value="Pengangge Aksara">Pengangge Suara</option>
                    <option value="Pengangge Tengenan">Pengangge Tengenan</option>
                    <option value="Aksara Suara">Aksara Suara</option>
                    <option value="Angka Bali">Angka Bali</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
                <button class="btn" id="resetBtn">Reset</button>
                <button class="btn btn-success" id="addNewBtn">Tambah Baru</button>
            </div>
        </div>
        
        <div class="stats-section">
            <h2 class="table-title">Statistik Database</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalAksara">0</div>
                    <div class="stat-label">Total Aksara</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeAksara">0</div>
                    <div class="stat-label">Aksara Aktif</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="categoriesCount">0</div>
                    <div class="stat-label">Kategori</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="has3dModels">0</div>
                    <div class="stat-label">Model 3D</div>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <div class="table-title">
                Daftar Aksara Bali
                <div>
                    <button class="btn btn-sm" id="exportBtn">Export Data</button>
                    <button class="btn btn-sm btn-primary" id="refreshBtn">Refresh</button>
                </div>
            </div>
            
            <div id="loadingState" class="loading hidden">
                <div class="loading-spinner"></div>
                <div class="loading-text">Memuat Data</div>
                <div class="loading-subtext">Mohon tunggu sebentar</div>
            </div>
            
            <div id="emptyState" class="empty-state hidden">
                <div class="empty-state-icon">📜</div>
                <h3>Tidak ada data ditemukan</h3>
                <p id="emptyMessage">Coba ubah filter pencarian atau tambahkan aksara baru</p>
            </div>
            
            <table class="data-table" id="aksaraTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Aksara</th>
                        <th>Nama</th>
                        <th>Latin</th>
                        <th>Kategori</th>
                        <th>Terakhir Diperbarui</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="aksaraTableBody"></tbody>
            </table>
            
            <div class="pagination" id="pagination"></div>
        </div>
    </div>
    
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Aksara</h3>
                <span class="close">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId" name="id">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editAksaraBali">Aksara Bali</label>
                        <input type="text" class="form-control" id="editAksaraBali" name="aksara_bali" placeholder="Masukkan aksara Bali" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editNama">Nama Aksara</label>
                        <input type="text" class="form-control" id="editNama" name="nama" placeholder="Nama aksara" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editLatin">Transliterasi Latin</label>
                        <input type="text" class="form-control" id="editLatin" name="latin" placeholder="Transliterasi dalam huruf latin" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="editKategori">Kategori</label>
                        <select class="form-control" id="editKategori" name="kategori" required>
                            <option value="">Semua Kategori</option>
                            <option value="Aksara Wianjana">Aksara Wianjana</option>
                            <option value="Gantungan">Gantungan</option>
                            <option value="Gempelan">Gempelan</option>
                            <option value="Aksara Swalalita">Aksara Swalalita</option>
                            <option value="Pengangge Aksara">Pengangge Suara</option>
                            <option value="Pengangge Tengenan">Pengangge Tengenan</option>
                            <option value="Aksara Suara">Aksara Suara</option>
                            <option value="Angka Bali">Angka Bali</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="editUnicodeAksara">Unicode</label>
                        <input type="text" class="form-control" id="editUnicodeAksara" name="unicode_aksara" placeholder="Unicode aksara (opsional)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="editContohPenggunaan">Contoh Penggunaan</label>
                    <input type="text" class="form-control" id="editContohPenggunaan" name="contoh_penggunaan" placeholder="Contoh penggunaan aksara">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="editDeskripsi">Deskripsi</label>
                    <textarea class="form-control" id="editDeskripsi" name="deskripsi" placeholder="Deskripsi mengenai aksara ini"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Model 3D</label>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <span id="modelStatus" style="color: #999;">Tidak ada model 3D</span>
                        <button type="button" class="btn btn-sm" id="viewModelBtn">Lihat Model</button>
                        <button type="button" class="btn btn-sm btn-warning" id="toggleModelUploadBtn">Ganti Model</button>
                    </div>
                    <div class="model-upload-zone" id="modelUploadZone">
                        <input type="file" id="modelFileInput" accept=".obj">
                        <p>Klik atau jatuhkan file 3D model (.obj) di sini</p>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" id="saveBtn">Simpan Perubahan</button>
                    <button type="button" class="btn" id="cancelEditBtn">Batal</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Konfirmasi Hapus</h3>
                <span class="close">&times;</span>
            </div>
            <div style="padding: 20px 0;">
                <p>Apakah Anda yakin ingin menghapus aksara ini?</p>
                <p style="margin-top: 15px; font-weight: 600;">
                    <span id="deleteAksaraChar" style="font-size: 2rem; margin-right: 10px;"></span>
                    <span id="deleteAksaraName"></span>
                </p>
                <p style="margin-top: 15px; color: #f87171;">
                    Tindakan ini tidak dapat dibatalkan.
                </p>
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Ya, Hapus</button>
                <button type="button" class="btn" id="cancelDeleteBtn">Batal</button>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let totalPages = 1;
        let totalItems = 0;
        let itemsPerPage = 10;
        let currentCategory = '';
        let currentSearch = '';
        let aksaraData = [];
        let modelFile = null;
        let currentAksaraName = '';
        
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const resetBtn = document.getElementById('resetBtn');
        const addNewBtn = document.getElementById('addNewBtn');
        const exportBtn = document.getElementById('exportBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const aksaraTable = document.getElementById('aksaraTable');
        const aksaraTableBody = document.getElementById('aksaraTableBody');
        const paginationElement = document.getElementById('pagination');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const alertContainer = document.getElementById('alertContainer');
        
        const editModal = document.getElementById('editModal');
        const deleteModal = document.getElementById('deleteModal');
        const closeEditModal = editModal.querySelector('.close');
        const closeDeleteModal = deleteModal.querySelector('.close');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        
        const modelUploadZone = document.getElementById('modelUploadZone');
        const toggleModelUploadBtn = document.getElementById('toggleModelUploadBtn');
        const modelFileInput = document.getElementById('modelFileInput');
        
        const API_BASE = '/api';
        
        async function init() {
            updateStats();
            setupEventListeners();
            await loadData();
        }
        
        async function loadData(page = 1) {
            try {
                showLoadingState();
                
                let endpoint = `/aksara?page=${page}&limit=${itemsPerPage}`;
                if (currentCategory) endpoint += `&kategori=${encodeURIComponent(currentCategory)}`;
                
                let data;
                if (currentSearch) {
                    data = await apiCall(`/aksara/search?q=${encodeURIComponent(currentSearch)}&page=${page}&limit=${itemsPerPage}`);
                } else {
                    data = await apiCall(endpoint);
                }
                
                if (data.success) {
                    aksaraData = data.data;
                    currentPage = data.pagination.page;
                    totalPages = data.pagination.totalPages;
                    totalItems = data.pagination.total;
                    
                    renderTable();
                    renderPagination();
                    
                    if (aksaraData.length === 0) {
                        showEmptyState();
                    }
                }
            } catch (error) {
                console.error('Failed to load data:', error);
                showAlert('error', 'Gagal memuat data. Silakan coba lagi.');
            } finally {
                hideLoadingState();
            }
        }
        
        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }
        
        function renderTable() {
            aksaraTableBody.innerHTML = '';
            
            if (aksaraData.length === 0) {
                aksaraTable.classList.add('hidden');
                showEmptyState();
                return;
            }
            
            aksaraTable.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            aksaraData.forEach(aksara => {
                const row = document.createElement('tr');
                
                const updatedDate = new Date(aksara.updated_at || aksara.created_at);
                const formattedDate = updatedDate.toISOString().split('T')[0];
                
                row.innerHTML = `
                    <td>${aksara.id}</td>
                    <td class="aksara-cell">${aksara.aksara_bali}</td>
                    <td>${aksara.nama}</td>
                    <td>${aksara.latin}</td>
                    <td><span class="category-badge">${aksara.kategori}</span></td>
                    <td>${formattedDate}</td>
                    <td class="action-cell">
                        <button class="btn btn-sm" data-action="view" data-id="${aksara.id}">Lihat</button>
                        <button class="btn btn-sm btn-warning" data-action="edit" data-id="${aksara.id}">Edit</button>
                        <button class="btn btn-sm btn-danger" data-action="delete" data-id="${aksara.id}">Hapus</button>
                    </td>
                `;
                
                aksaraTableBody.appendChild(row);
            });
            
            const actionButtons = aksaraTableBody.querySelectorAll('[data-action]');
            actionButtons.forEach(button => {
                const action = button.getAttribute('data-action');
                const id = button.getAttribute('data-id');
                
                button.addEventListener('click', () => {
                    handleAction(action, id);
                });
            });
        }
        
        function handleAction(action, id) {
            const aksara = aksaraData.find(item => item.id == id);
            
            if (!aksara) {
                showAlert('error', 'Data aksara tidak ditemukan.');
                return;
            }
            
            switch(action) {
                case 'view':
                    window.location.href = `/?id=${id}`;
                    break;
                    
                case 'edit':
                    openEditModal(aksara);
                    break;
                    
                case 'delete':
                    openDeleteModal(aksara);
                    break;
            }
        }
        
        function openEditModal(aksara) {
            document.getElementById('editId').value = aksara.id;
            document.getElementById('editAksaraBali').value = aksara.aksara_bali;
            document.getElementById('editNama').value = aksara.nama;
            document.getElementById('editLatin').value = aksara.latin;
            document.getElementById('editKategori').value = aksara.kategori;
            document.getElementById('editUnicodeAksara').value = aksara.unicode_aksara || '';
            document.getElementById('editContohPenggunaan').value = aksara.contoh_penggunaan || '';
            document.getElementById('editDeskripsi').value = aksara.deskripsi || '';
            
            currentAksaraName = aksara.nama;
            modelFile = null;
            modelUploadZone.style.display = 'none';
            
            const modelStatus = document.getElementById('modelStatus');
            const viewModelBtn = document.getElementById('viewModelBtn');
            
            if (aksara.has_model) {
                modelStatus.textContent = 'Model 3D tersedia';
                modelStatus.style.color = '#4ade80';
                viewModelBtn.disabled = false;
            } else {
                modelStatus.textContent = 'Tidak ada model 3D';
                modelStatus.style.color = '#999';
                viewModelBtn.disabled = true;
            }
            
            editModal.style.display = 'block';
        }
        
        function openDeleteModal(aksara) {
            document.getElementById('deleteAksaraChar').textContent = aksara.aksara_bali;
            document.getElementById('deleteAksaraName').textContent = aksara.nama;
            
            confirmDeleteBtn.setAttribute('data-id', aksara.id);
            
            deleteModal.style.display = 'block';
        }
        
        function renderPagination() {
            if (totalPages <= 1) {
                paginationElement.innerHTML = '';
                return;
            }
            
            let html = '';
            
            html += `<button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">‹</button>`;
            
            const maxVisiblePages = 5;
            const halfVisible = Math.floor(maxVisiblePages / 2);
            
            let startPage = Math.max(1, currentPage - halfVisible);
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                html += `<button onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            html += `<button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">›</button>`;
            
            paginationElement.innerHTML = html;
        }
        
        function changePage(page) {
            if (page >= 1 && page <= totalPages) {
                loadData(page);
            }
        }
        
        async function updateStats() {
            try {
                const response = await apiCall('/stats');
                
                if (response.success) {
                    const stats = response.data;
                    document.getElementById('totalAksara').textContent = stats.total || 0;
                    document.getElementById('activeAksara').textContent = stats.activeCount || stats.total || 0;
                    document.getElementById('categoriesCount').textContent = stats.categories?.length || 0;
                    document.getElementById('has3dModels').textContent = stats.modelsCount || 0;
                }
            } catch (error) {
                console.error('Failed to load statistics:', error);
            }
        }
        
        function showLoadingState() {
            loadingState.classList.remove('hidden');
            aksaraTable.classList.add('hidden');
            emptyState.classList.add('hidden');
        }
        
        function hideLoadingState() {
            loadingState.classList.add('hidden');
        }
        
        function showEmptyState() {
            emptyState.classList.remove('hidden');
            aksaraTable.classList.add('hidden');
            
            let message = 'Tidak ada data ditemukan.';
            
            if (currentSearch) {
                message = `Tidak ada hasil untuk "${currentSearch}"`;
            } else if (currentCategory) {
                message = `Tidak ada data dalam kategori "${currentCategory}"`;
            }
            
            document.getElementById('emptyMessage').textContent = message;
        }
        
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <div>${message}</div>
                <button class="alert-close">&times;</button>
            `;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);
            alertContainer.classList.remove('hidden');
            
            alertDiv.querySelector('.alert-close').addEventListener('click', function() {
                alertContainer.classList.add('hidden');
            });
            
            setTimeout(() => {
                alertContainer.classList.add('hidden');
            }, 5000);
        }

        function resetModelUploadForm() {
            modelUploadZone.style.display = 'none';
            toggleModelUploadBtn.textContent = 'Ganti Model';
            modelFileInput.value = '';
            modelFile = null;
            modelUploadZone.innerHTML = '<input type="file" id="modelFileInput" accept=".obj"><p>Klik atau jatuhkan file 3D model (.obj) di sini</p>';
        }
        
        function setupEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', () => {
                const searchTerm = searchInput.value.trim();
                currentSearch = searchTerm;
                currentPage = 1;
                loadData();
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const searchTerm = searchInput.value.trim();
                    currentSearch = searchTerm;
                    currentPage = 1;
                    loadData();
                }
            });
            
            categoryFilter.addEventListener('change', () => {
                currentCategory = categoryFilter.value;
                currentPage = 1;
                loadData();
            });
            
            resetBtn.addEventListener('click', () => {
                searchInput.value = '';
                categoryFilter.value = '';
                currentSearch = '';
                currentCategory = '';
                currentPage = 1;
                loadData();
            });
            
            addNewBtn.addEventListener('click', () => {
                window.location.href = '/upload';
            });
            
            exportBtn.addEventListener('click', () => {
                showAlert('warning', 'Fitur export data sedang dalam pengembangan.');
            });
            
            refreshBtn.addEventListener('click', () => {
                loadData(currentPage);
                updateStats();
            });
            
            closeEditModal.addEventListener('click', () => {
                editModal.style.display = 'none';
                resetModelUploadForm();
            });
            
            closeDeleteModal.addEventListener('click', () => {
                deleteModal.style.display = 'none';
            });
            
            cancelEditBtn.addEventListener('click', () => {
                editModal.style.display = 'none';
                resetModelUploadForm();
            });
            
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.style.display = 'none';
            });
            
            toggleModelUploadBtn.addEventListener('click', () => {
                if (modelUploadZone.style.display === 'block') {
                    resetModelUploadForm();
                } else {
                    modelUploadZone.style.display = 'block';
                    toggleModelUploadBtn.textContent = 'Batalkan';
                }
            });
            
            modelUploadZone.addEventListener('click', () => {   
                modelFileInput.click();
            });
            
            modelFileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    modelFile = e.target.files[0];
                    modelUploadZone.innerHTML = `<p>File dipilih: ${modelFile.name}</p>`;
                }
            });
            
            modelUploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                modelUploadZone.style.borderColor = '#4f46e5';
            });
            
            modelUploadZone.addEventListener('dragleave', () => {
                modelUploadZone.style.borderColor = '#333';
            });
            
            modelUploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                modelUploadZone.style.borderColor = '#333';
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    modelFile = e.dataTransfer.files[0];
                    modelUploadZone.innerHTML = `<p>File dipilih: ${modelFile.name}</p>`;
                }
            });
            
            document.getElementById('editForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.textContent = 'Menyimpan...';
                saveBtn.disabled = true;
                
                const formData = new FormData(e.target);
                const id = formData.get('id');
                const newName = formData.get('nama');
                
                const data = {};
                formData.forEach((value, key) => {
                    data[key] = value;
                });
                
                try {
                    // First update the aksara data
                    const response = await fetch(`${API_BASE}/aksara/${id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // If a new model file was uploaded
                        if (modelFile) {
                            const modelFormData = new FormData();
                            
                            // Create a new File object with the name matching the aksara name
                            const cleanName = newName.replace(/[^a-zA-Z0-9]/g, '_');
                            const newFile = new File([modelFile], `${cleanName}.obj`, {
                                type: modelFile.type
                            });
                            
                            // Append the renamed file to form data
                            modelFormData.append('model_file', newFile);
                            modelFormData.append('nama', newName);
                            
                            try {
                                const modelResponse = await fetch(`${API_BASE}/aksara/${id}/model`, {
                                    method: 'POST',
                                    body: modelFormData
                                });
                                
                                const modelResult = await modelResponse.json();
                                
                                if (modelResult.success) {
                                    showAlert('success', 'Aksara dan model 3D berhasil diperbarui!');
                                } else {
                                    showAlert('warning', 'Aksara diperbarui tetapi gagal mengunggah model 3D.');
                                }
                            } catch (modelError) {
                                console.error('Model upload failed:', modelError);
                                showAlert('warning', 'Aksara diperbarui tetapi gagal mengunggah model 3D.');
                            }
                        } else {
                            // If no new model, but name was changed, we need to rename the existing model file
                            if (currentAksaraName !== newName) {
                                try {
                                    // Call a special endpoint to rename the model file
                                    await fetch(`${API_BASE}/aksara/${id}/rename-model`, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            oldName: currentAksaraName,
                                            newName: newName
                                        })
                                    });
                                } catch (renameError) {
                                    console.error('Model rename failed:', renameError);
                                }
                            }
                            showAlert('success', 'Aksara berhasil diperbarui!');
                        }
                        
                        editModal.style.display = 'none';
                        loadData(currentPage);
                    } else {
                        showAlert('error', `Gagal: ${result.message}`);
                    }
                } catch (error) {
                    console.error('Update failed:', error);
                    showAlert('error', 'Gagal memperbarui aksara. Silakan coba lagi.');
                } finally {
                    saveBtn.textContent = 'Simpan Perubahan';
                    saveBtn.disabled = false;
                }
            });
            
            confirmDeleteBtn.addEventListener('click', async () => {
                const id = confirmDeleteBtn.getAttribute('data-id');
                confirmDeleteBtn.textContent = 'Menghapus...';
                confirmDeleteBtn.disabled = true;
                
                try {
                    const response = await fetch(`${API_BASE}/aksara/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert('success', 'Aksara berhasil dihapus!');
                        deleteModal.style.display = 'none';
                        loadData(currentPage);
                        updateStats();
                    } else {
                        showAlert('error', `Gagal: ${result.message}`);
                    }
                } catch (error) {
                    console.error('Delete failed:', error);
                    showAlert('error', 'Gagal menghapus aksara. Silakan coba lagi.');
                } finally {
                    confirmDeleteBtn.textContent = 'Ya, Hapus';
                    confirmDeleteBtn.disabled = false;
                }
            });
            
            document.getElementById('viewModelBtn').addEventListener('click', () => {
                const id = document.getElementById('editId').value;
                window.open(`/?view=3d&id=${id}`, '_blank');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    editModal.style.display = 'none';
                    resetModelUploadForm();
                } else if (e.target === deleteModal) {
                    deleteModal.style.display = 'none';
                }
            });
        }
        
        window.changePage = changePage;
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>